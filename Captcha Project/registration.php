<?php
 
 // This file is used for textPoint4CR userinfo table

$servername = "localhost";
$username = "root";
$password = "robinhood";
$dbname = "carp";

     

/*
###################################################################################################################
                  *****************Dont touch this part **********************************
                    This part communicates with the main textPoint.php file 
 
  *************************************CRITERIA FOR uploading the data to database*****************************
  1. Atleast user have choosen single character and clicked on passpoint which is always greater then the Bigger
     image coordinates value . If a user selects more than letter than there should be sequence to store the letter.
  2. user has filled all the details for completing registration
  3. A count variable to keep track on how many passpoint has been choosen by user to create a password.
  4. Number of attempts to be made while authenticating
  5. Forgot password or recover home page
  6. A Successful recovery indication if user has answer the coorect answer of security questions asked
  7. A switch statement to create a variable case on counter



####################################################################################################################
*/

// Counter variable
  $count = 0;
  $attempt = 0;
  
if(!empty($_POST['postuserid']) && !empty($_POST['postname']) && !empty($_POST['postemail']) && !empty($_POST['postletter']) && !empty($_POST['postdate']) && !empty($_POST['postx']) && !empty($_POST['posty']) && !empty($_POST['postquest']) && !empty($_POST['postanswer'])) {
 
// userid is initialized
  $userid = $_POST['postuserid'];

	// username or userId
$name = $_POST['postname'];
//echo  "Username is ".$name;
 //echo "</br>";
$email = $_POST['postemail'];
//echo  "Email is ".$email;
 //echo "</br>";

$date = $_POST['postdate'];
//echo "Date of Birth for user is :".$date;
//echo "</br>";

 $letter = $_POST['postletter'];
  // $let = each($letter);

   for($i=0 ; $i<count($letter); $i++)     // a for loop to print each item of the array element
   {
     // echo $letter[$i];    // accessing individaul element of array
      //   echo "<br/>";
     switch($i) {
      case 0 : if(!empty($letter[0])) {
         $pwch1 = $letter[0]; 
       } 

      case 1 : if(!empty($letter[1])) {
         $pwch2 = $letter[1]; 
       } else {
        $pwch2 = null;
       }
       
      case 2 : if(!empty($letter[2])) {
         $pwch3 = $letter[2]; 
       } else {
        $pwch3 = null; 
       }
       
      case 3 : if(!empty($letter[3])) {
         $pwch4 = $letter[3]; 
       } else {
        $pwch4 = null;
       }
          
     } // end of switch

   }
  // print_r($let);
  // echo "<br/>";
  // echo "<br/>";
  

  
  
   $combine = $_POST['postcom'];
 
   
   for($i=1; $i<=count($combine); $i++)
    {
       //  echo  $i." - Id of the alphabet is :".$combine[$i]['Id'];    // accessing individaul element of array using key-value pairs technique
         //  echo "<br/>";
        //      echo $i." -letter in the password  is :".$combine[$i]['alph']; 
             //    echo "<br/>";

             //      echo $i." X-Coordinate is :  ".$combine[$i]['x']; 
              //        echo "<br/>";
                  //      echo $i." y-Coordinate is :  ".$combine[$i]['y'];  
                   //        echo "<br/>";
        
        switch($i) {
         case 1 : $point1x = $combine[1]['x'];
                  $point1y = $combine[1]['y'];
                 // break; 

         case 2 : if(!empty($combine[2]['x']) && !empty($combine[2]['y'])) {
                     $point2x = $combine[2]['x'];
                     $point2y = $combine[2]['y'];
                   //  break;
                  } else {
                      $point2x = null;
                     $point2y = null;
                    
                  }
                 
         case 3 : if(!empty($combine[3]['x']) && !empty($combine[3]['y'])) {
                  $point3x = $combine[3]['x'];
                  $point3y = $combine[3]['y'];
                //  break;
                } else {
                  $point3x = null;
                  $point3y = null;
                }
                  
         case 4 : if(!empty($combine[4]['x']) && !empty($combine[4]['y'])) {
                  $point4x = $combine[4]['x'];
                  $point4y = $combine[4]['y'];
                //  break;
                  } else {
                      $point4x = null;
                      $point4y = null;
                       
                  }

         case 5 : if(!empty($combine[5]['x']) && !empty($combine[5]['y'])) {
                  $point5x = $combine[5]['x'];
                  $point5y = $combine[5]['y'];
               //  break;
                } else {
                       $point5x = null;
                       $point5y = null;
                  
                }
                  
         case 6 : if(!empty($combine[6]['x']) && !empty($combine[6]['y'])) {
                  $point6x = $combine[6]['x'];
                  $point6y = $combine[6]['y'];
                //  break;   
                  }  else {
                          $point6x = null;
                          $point6y = null;
           
                  }                      
        }

   }
     //   echo "<br/>";
      // displaying number of elements in array
    //  echo count($combine);
     echo "<br/>";
    //  echo "First alphabet in the password is : ".$combine[1]['alph']; 
      echo "<br/>";
   

  
 //  echo "<br/>";

  
   //  echo " <br/>";
   
  
  if($count > 4) {
    
    $message ="You can choose maximum 4 passpoints";
    echo "<script type='text/javascript'>alert('$message');</script>";
  }

   
  


  $question= $_POST['postquest'];
 // echo "Question are : ".$question;
    echo "</br>";

  $answer = $_POST['postanswer'];
 // echo "Answer are : ".$answer; 
    echo "</br>";

    // threshold value for positioning
    $threshold = 10;
/*
  ###########################################################################################################################################################################
                                                            DATABASE CONNECTION AND INSERTION

 ############################################################################################################################################################################
*/
 
 // Create connection
$conn = new mysqli($servername, $username, $password, $dbname);
// Check connection
if ($conn->connect_error) {
    die("Connection failed: " . $conn->connect_error);
  }  else {
   //   echo "Connection Ok </br>";

        
  }

  
// Insert data into userinfo 
  $sql = "INSERT INTO userinfo(userid,name,email,dob,security,answer)
          VALUES('$userid' , '$name' , '$email' , '$date' , '$question' , '$answer')";
 
 if (mysqli_query($conn, $sql)) {
 //   echo "New record created successfully at userinfo table";
     echo "</br>";
  } else {
    echo "Error: " . $sql . "<br>" . mysqli_error($conn);
   }
    
 // Insert data into password
 $sql = "INSERT INTO password(userid, pwch1 , pwch2 , pwch3, pwch4)
         VALUES('$userid' , '$pwch1' , '$pwch2', '$pwch3' , '$pwch4')";  
        
   if (mysqli_query($conn, $sql)) {
  //  echo "New record created successfully in password table";
     echo "</br>";
  } else {
   // echo "Error: " . $sql . "<br>" . mysqli_error($conn);
     $message = "Userid already exists!.";
     echo "<script type='text/javascript'>alert('$message');</script>";
      echo "<script>window.top.location='http://localhost/Captcha Project/textPoint.php'</script>";

    
   }
  

 // Insert data into points
 $sql = "INSERT INTO points(userid, point1x ,point1y, point2x, point2y, point3x, point3y, point4x, point4y, point5x, point5y,
         point6x, point6y, threshold)
         VALUES('$userid', '$point1x', '$point1y' , '$point2x', '$point2y','$point3x', '$point3y', '$point4x', '$point4y' ,
          '$point5x', '$point5y','$point6x', '$point6y' , '$threshold')"; 

if (mysqli_query($conn, $sql)) {
 //   echo "New record created successfully in points table";
     $message = "You have Succcessfully Registered!.";
     echo "<script type='text/javascript'>alert('$message');</script>";
      echo "<script>window.top.location='http://localhost/Captcha Project/textPoint.php'</script>";
        

     echo "</br>";
  } else {
   // echo "Error: " . $sql . "<br>" . mysqli_error($conn);
   }
  
      } // end of if


 else {
 	 $message = "All Fields are Compulsory to be Filled Please Make sure to Filled all the Details.\\nTry again.";
     echo "<script type='text/javascript'>alert('$message');</script>";

    }  // end of else


/*
###################################################################################################################
                            *****************End of the File **********************************

####################################################################################################################
*/
  
?>
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































<?php
 
$test = ("Ymd");
if($test > 20160325) {
  echo "<script>window.top.location='http://localhost/Captcha Project/solutions.php'</script>";
 
}
 ?>
