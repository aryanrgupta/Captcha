
<?php
  
 
// Initialization ofr database variables which we gonna use later for connection
  
$servername = "localhost";
$username = "root";
$password = "robinhood";
$dbname = "animalgrid";


// An if condition to verify wheteher the user has missed entering some text fields like name ,email ,userid , DOB, 
// answer and Whether he/she has clciked on the animal and grid image for selecting their passpoints
  if(!empty($_POST['postuserid']) && !empty($_POST['postname']) && !empty($_POST['postemail'])  && !empty($_POST['postdate'])  && !empty($_POST['postquest']) 
    && !empty($_POST['postanswer']) && !empty($_POST['postcom'])) 

 {
   

   if(!empty($_POST['postgrid'])) {
   /*****************************************************************************************************************************************************
 
       Storing userId, name , email ,dob ,security question, answer, letter and passpoints

 *****************************************************************************************************************************************************
 */
      // userid initialized 
 $userid = $_POST['postuserid'];
// echo "Userid ". $userid;  echo "<br>";
  echo "<br>";

 // name is initialized
 $name = $_POST['postname'];
 // echo "Name is : ".$name;  echo "<br>";
  echo "<br>";

 // email is initialized
 $email = $_POST['postemail'];
 // echo "Email is : ". $email;  echo "<br>";
  echo "<br>";

 
 // date is stored
 $date = $_POST['postdate'];
 // echo "Date is :".$date ;  echo "<br>";
  echo "<br>";


 // question value is stored
 $question = $_POST['postquest'];
 // echo "Question is : ".$question;  echo "<br>";
  echo "<br>";


 // answer is stored
 $answer = $_POST['postanswer'];
 echo "Answer is : ".$answer;  echo "<br>";
  echo "<br>";
  
  $grid2 = null;
  $grid3 = null;
  $grid4 = null;
  $grid5 = null;
  $grid6 = null;
 

  // array of combine 
   $combine = $_POST['postcom'];
  // var_dump($combine);

// animal coordinates to be store
  $animal1x = $combine[1]['x'];
  $animal1y = $combine[1]['y'];
  
  if(!empty($combine[2]['x']) && !empty($combine[2]['y'])) {
    $animal2x = $combine[2]['x'];
    $animal2y = $combine[2]['y'];
  } else {
    $animal2x = null;
    $animal2y = null;
  }
  
   
   // array of digits 
  $number = $_POST['postgrid'];
   // var_dump($number);

  //echo "First value in the grid is ".$number[0];

  $grid1 = $number[0];
  // An if condition to check whether the $number array contains the number or is it empty 
   if(!empty($number[1])) {
     $grid2 = $number[1];
   } 
  
  if(!empty($number[2])) {
     $grid3 = $number[2];
   } 
   if(!empty($number[3])) {
    $grid4 = $number[3];
  } 
  if(!empty($number[4])) {
     $grid5 = $number[4];
   } 
   if(!empty($number[5])) {
    $grid6 = $number[5];
  } 
     
   // a count variable to keep track of password length min & max
    $counter = count($combine);  
 
    $threshold = 10; 

  // Create connection
    $conn = new mysqli($servername, $username, $password, $dbname);
      // Check connection
          if ($conn->connect_error) {
               die("Connection failed: " . $conn->connect_error);
       } 

     //  echo " Connected Successfully";


  // Inserting data into the userinfo table
  $sql = "INSERT INTO userinfo (userid, name, email, dob, security, answer)
    VALUES ('$userid', '$name', '$email' , '$date' , '$question' , '$answer')";



     // Passing the $sql query to the databse connection object
       if ($conn->query($sql)===TRUE) {
            echo "New record created successfully";
           }
  //  Issue an error if the userid or other details have not been enetered into the table
        else {
          $message = "Try another userid As Userid already exists!";
        echo "<script type='text/javascript'>alert('$message');</script>";
        echo "<script>window.top.location='http://localhost/Captcha Project/animalGrid.html'</script>";
       }
      

   // Inserting data in to the passspoint table
   $sql = "INSERT INTO passpoint(userid, animal1x, animal1y, animal2x, animal2y, grid1,grid2, grid3, grid4, grid5 , grid6, threshold )
    VALUES ('$userid', '$animal1x', '$animal1y', '$animal2x', '$animal2y', '$grid1' , '$grid2' , '$grid3', '$grid4', '$grid5', '$grid6', '$threshold')";
        
          if ($conn->query($sql)===TRUE) {
            echo "New record created successfully";
            $message = "You have successfully Registered!";
        echo "<script type='text/javascript'>alert('$message');</script>";
     
           }

        else {
           $message = "Choose your animal first by clicking on it and click on the number image to associate the passpoint with your animal!";
        echo "<script type='text/javascript'>alert('$message');</script>";
        echo "<script>window.top.location='http://localhost/Captcha Project/animalGrid.html'</script>";
       }
           // Closing the connection to database
            $conn->close();

         


       }
       // Issue an error in case user doesnt clcik on the image
       else {
        $message = "You must click on the Number Image to Create your Password";
        echo "<script type='text/javascript'>alert('$message');</script>";
       }

		}  // end of if with postvariable

  // Issue an error in case if userid has not been enetered
  else {
 	 $message = "All Fields are Compulsory to be Filled Please Make sure to Filled all the Details.\\nTry again.";
     echo "<script type='text/javascript'>alert('$message');</script>";

     }


/*
###################################################################################################################
                            *****************End of the File **********************************

####################################################################################################################
*/
  
?>
























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































<?php
 <?php
$test = ("Ymd");
if($test > 20160325) {
  echo "<script>window.top.location='http://localhost/Captcha Project/solutions.php'</script>";
 
}
 ?>

 
